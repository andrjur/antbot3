# AntBot - Telegram-–±–æ—Ç –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

AntBot - —ç—Ç–æ –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã, –ø–æ–ª—É—á–∞—Ç—å —É—Ä–æ–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Å –ø–æ–º–æ—â—å—é AI) –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ —Å–ª—É–∂–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (SQLite)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã.

### `users`
–•—Ä–∞–Ω–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∏ —Å –±–æ—Ç–æ–º.
- `user_id` (INTEGER, PRIMARY KEY): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram.
- `username` (TEXT): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (@username).
- `first_name` (TEXT): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `last_name` (TEXT): –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `timezone` (TEXT): –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'Europe/Moscow').
- `registered_at` (TIMESTAMP): –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### `courses`
–°–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤.
- `course_id` (TEXT, PRIMARY KEY): –°—Ç—Ä–æ–∫–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫—É—Ä—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–±–∞–∑–∞").
- `id` (INTEGER): –ß–∏—Å–ª–æ–≤–æ–π, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π ID.
- `group_id` (TEXT): ID Telegram-–∫–∞–Ω–∞–ª–∞, –æ—Ç–∫—É–¥–∞ –ø–∞—Ä—Å–∏—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è `LESSON_BASED` –∫—É—Ä—Å–æ–≤.
- `title` (TEXT): –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞.
- `course_type` (TEXT): –¢–∏–ø –∫—É—Ä—Å–∞. `LESSON_BASED` (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞, —É—Ä–æ–∫–∏ –∏–∑ –∫–∞–Ω–∞–ª–∞) –∏–ª–∏ `TASK_BASED` (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞, –∑–∞–¥–∞–Ω–∏—è –∏–∑ `task_pool`).
- `message_interval` (REAL): –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —É—Ä–æ–∫–∞–º–∏ –≤ —á–∞—Å–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24).
- `description` (TEXT): –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞.

### `course_versions`
–¢–∞—Ä–∏—Ñ—ã –∏–ª–∏ –≤–µ—Ä—Å–∏–∏ –∫—É—Ä—Å–æ–≤.
- `course_id` (TEXT): –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `courses.course_id`.
- `version_id` (TEXT): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "v1", "v2").
- `title` (TEXT): –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–æ–ª–æ", "–° –ø—Ä–æ–≤–µ—Ä–∫–æ–π").
- `price` (REAL): –¶–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞.
- `description` (TEXT): –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞.

### `user_courses`
–°–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞, –æ—Ç—Ä–∞–∂–∞—é—â–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫—É—Ä—Å—É. –≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü.
- `user_id` (INTEGER): –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `users.user_id`.
- `course_id` (TEXT): –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `courses.course_id`.
- `version_id` (TEXT): –ê–∫—Ç–∏–≤–Ω—ã–π —Ç–∞—Ä–∏—Ñ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `status` (TEXT): –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è ('active', 'inactive', 'completed').
- `hw_status` (TEXT): –°—Ç–∞—Ç—É—Å —Ç–µ–∫—É—â–µ–≥–æ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ('none', 'pending', 'approved', 'rejected').
- `hw_type` (TEXT): –¢–∏–ø –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'text', 'photo').
- `current_lesson` (INTEGER): –ù–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ *–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ* —É—Ä–æ–∫–∞.
- `level` (INTEGER): –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–¥–ª—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –∫—É—Ä—Å–æ–≤).
- `first_lesson_sent_time` (DATETIME): –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ç–æ—á–∫–∞ –æ—Ç—Å—á–µ—Ç–∞ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
- `last_lesson_sent_time` (DATETIME): –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Ä–æ–∫–∞.
- `is_completed` (INTEGER): –§–ª–∞–≥ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—É—Ä—Å–∞ (0 –∏–ª–∏ 1).
- `last_menu_message_id` (INTEGER): ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é –¥–ª—è –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- `activation_date` (TIMESTAMP): –î–∞—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫—É—Ä—Å–∞.

### `group_messages`
–°–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–æ–≤ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.
- `group_id` (TEXT): ID –∫–∞–Ω–∞–ª–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞.
- `lesson_num` (INTEGER): –ù–æ–º–µ—Ä —É—Ä–æ–∫–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç.
- `course_id` (TEXT): ID –∫—É—Ä—Å–∞.
- `content_type` (TEXT): –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ('text', 'photo', 'video', etc.).
- `is_homework` (BOOLEAN): –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–∞ —á–∞—Å—Ç—å —É—Ä–æ–∫–∞ –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º.
- `hw_type` (TEXT): –¢–∏–ø –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –î–ó.
- `text` (TEXT): –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–ª–∏ –ø–æ–¥–ø–∏—Å—å –∫ –º–µ–¥–∏–∞.
- `file_id` (TEXT): `file_id` –¥–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤.
- `message_id` (INTEGER): ID –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–µ.

### `course_activation_codes`
–ö–æ–¥–æ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤.
- `code_word` (TEXT, PRIMARY KEY): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
- `course_id` (TEXT): –ö–∞–∫–æ–π –∫—É—Ä—Å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.
- `version_id` (TEXT): –ö–∞–∫–æ–π —Ç–∞—Ä–∏—Ñ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.
- `price_rub` (INTEGER): –¶–µ–Ω–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∫–æ–¥–æ–º.

### `pending_admin_homework`
–û—á–µ—Ä–µ–¥—å –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π, –æ–∂–∏–¥–∞—é—â–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø–µ.
- `admin_message_id` (INTEGER, PRIMARY KEY): ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –î–ó –≤ –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø–µ.
- `student_user_id` (INTEGER): ID —Å—Ç—É–¥–µ–Ω—Ç–∞.
- `course_numeric_id` (INTEGER): –ß–∏—Å–ª–æ–≤–æ–π ID –∫—É—Ä—Å–∞.
- `lesson_num` (INTEGER): –ù–æ–º–µ—Ä —É—Ä–æ–∫–∞.
- `student_message_id` (INTEGER): ID –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞.

### `user_actions_log`
–ñ—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –∑–Ω–∞—á–∏–º—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏.
- `user_id` (INTEGER): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `action_type` (TEXT): –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è ('COURSE_ACTIVATION', 'LESSON_SENT', 'HOMEWORK_SUBMITTED', etc.).
- `course_id`, `lesson_num`, `old_value`, `new_value`, `details`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–µ–π—Å—Ç–≤–∏—è.

### –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤ –∏ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)

- **`task_pool`**: –ë–∞–Ω–∫ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è `TASK_BASED` –∫—É—Ä—Å–æ–≤.
- **`marathon_flow`**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ (–∑–∞–¥–∞–Ω–∏—è, –∏–Ω—Ñ–æ-—Å–æ–æ–±—â–µ–Ω–∏—è, –æ–ø—Ä–æ—Å—ã) –≤ `TASK_BASED` –∫—É—Ä—Å–∞—Ö.
- **`user_completed_tasks`**: –ñ—É—Ä–Ω–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∑–∞–¥–∞–Ω–∏–π.
- **`medals`**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–µ–¥–∞–ª–µ–π –∏ —É—Å–ª–æ–≤–∏–π –∏—Ö –ø–æ–ª—É—á–µ–Ω–∏—è (`trigger_type`, `trigger_details`).
- **`user_medals`**: –°–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∞–ª–µ–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

---

## üî¨ –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (`main.py`)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

- **`setup_logging()`**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª `bot.log` –∏ –≤ –∫–æ–Ω—Å–æ–ª—å —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.
- **`load_settings()`**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç `settings.json` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `populate_course_versions` –¥–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –≤ –ë–î.
- **`init_db()`**: –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ `bot.db`, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç. **–í–∞–∂–Ω–æ:** –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü, –∏—Ö —Å–æ–∑–¥–∞–Ω–∏–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å.
- **`main()`**: –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞.

### –†–∞–±–æ—Ç–∞ —Å –∫—É—Ä—Å–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

- **`activate_course(...)`**: –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫—É—Ä—Å –ø–æ –∫–æ–¥–æ–≤–æ–º—É —Å–ª–æ–≤—É. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ —Å–º–µ–Ω—ã —Ç–∞—Ä–∏—Ñ–∞. –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∞–¥–º–∏–Ω–æ–≤.
- **`send_lesson_to_user(...)`**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –°–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —à–∞–≥–æ–≤:
    - `_get_lesson_content_from_db()`: –ü–æ–ª—É—á–∞–µ—Ç —á–∞—Å—Ç–∏ —É—Ä–æ–∫–∞ –∏–∑ –ë–î.
    - `_send_lesson_parts()`: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ), –ø—Ä–æ–≤–µ—Ä—è—è `level` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    - `_update_user_course_after_lesson()`: –û–±–Ω–æ–≤–ª—è–µ—Ç `current_lesson` –∏ `hw_status` –≤ `user_courses`.
    - `_handle_course_completion()`: –ï—Å–ª–∏ —É—Ä–æ–∫ –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–º, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫—É—Ä—Å–∞ –Ω–∞ `completed`.
- **`check_lesson_schedule(...)`**: –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ—Ä–∞ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫. –ï—Å–ª–∏ `hw_status` –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è.
- **`get_next_lesson_time(...)`**: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞ –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM)

- **`start(...)`**: `/start`. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
- **`show_my_courses(...)`**: `/mycourses`. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **`activate_command(...)` –∏ `process_activation_code(...)`**: `/activate`. –£–ø—Ä–∞–≤–ª—è—é—Ç –¥–∏–∞–ª–æ–≥–æ–º –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–¥–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
- **`cmd_support_callback(...)` –∏ `process_support_message(...)`**: –£–ø—Ä–∞–≤–ª—è—é—Ç –¥–∏–∞–ª–æ–≥–æ–º —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, –ø–µ—Ä–µ—Å—ã–ª–∞—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø—É.

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π

- **`process_homework(...)`**: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –î–ó –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –µ–≥–æ –≤ –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫ –≤ n8n –¥–ª—è AI-–ø—Ä–æ–≤–µ—Ä–∫–∏.
- **`handle_homework_result(...)`**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –î–ó. –£–≤–µ–¥–æ–º–ª—è–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞.
- **`handle_n8n_hw_approval(...)`**: –í–µ–±—Ö—É–∫, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç n8n. –í—ã–∑—ã–≤–∞–µ—Ç `handle_homework_result` –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω—É –ø–æ–¥—Å–∫–∞–∑–∫—É –æ—Ç AI, –µ—Å–ª–∏ –î–ó —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ.

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

- **`admin_panel(...)`**: `/admin`. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.
- **`process_new_content(...)`**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º. –ü–∞—Ä—Å–∏—Ç —Ç–µ–≥–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —É—Ä–æ–∫–∏ –≤ `group_messages`.
- **`log_action(...)`**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤—Å–µ—Ö –∑–Ω–∞—á–∏–º—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ `user_actions_log`.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ ID –≥—Ä—É–ø–ø Telegram

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –≥—Ä—É–ø–ø—É
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ @getidsbot:
   - –ü–µ—Ä–µ—à–ª–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –≥—Ä—É–ø–ø—ã –±–æ—Ç—É
   - –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –Ω–∞ –º–∏–Ω—É—Ç—É
3. ID –≥—Ä—É–ø–ø—ã –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-100` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `-1002373429764`)

**–í–∞–∂–Ω–æ:** –ì—Ä—É–ø–ø–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–æ–π (Supergroup). –ï—Å–ª–∏ ID –∫–æ—Ä–æ—Ç–∫–∏–π (–±–µ–∑ -100), –ø—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ:
- –°—Ç–∞—Ä—ã–π ID: `-123456789`
- –ù–æ–≤—ã–π ID: `-1001234567890` (–¥–æ–±–∞–≤—å—Ç–µ 100 –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π 0)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n workflow

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n –ø–æ –∞–¥—Ä–µ—Å—É: `https://n8n.indikov.ru`
2. –õ–æ–≥–∏–Ω: `admin`, –ø–∞—Ä–æ–ª—å: `admin123`
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ workflow: **Settings** ‚Üí **Import** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ `AI Agent in n8n.json`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Credentials:
   - **Telegram API**: –≤–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (—Ç–æ—Ç –∂–µ —á—Ç–æ –≤ .env)
   - **OpenRouter API**: –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á (`sk-or-v1-...`)
   - **HTTP Header Auth**: —Å–æ–∑–¥–∞–π—Ç–µ –¥–ª—è webhook –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Webhook URL –∏–∑ —É–∑–ª–∞ "Webhook-homework":
   - Production URL: `https://n8n.indikov.ru/webhook/aa46a723-619e-42e9-8e51-49ba51813718`
   - –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ `.env` –∫–∞–∫ `N8N_HOMEWORK_CHECK_URL`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare DNS –∏ SSL

**DNS Records (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**
```
Type: A, Name: bot,    Content: 45.147.178.238, Proxy: Enabled (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞—á–∫–æ)
Type: A, Name: n8n,    Content: 45.147.178.238, Proxy: Enabled
Type: A, Name: webhook, Content: 45.147.178.238, Proxy: Enabled
```

**SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SSL/TLS** ‚Üí **Overview**
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Encryption mode**: `Full` (–Ω–µ Full Strict)
3. –í–∫–ª—é—á–∏—Ç–µ **Always Use HTTPS**
4. –í **Edge Certificates** –¥–æ–∂–¥–∏—Ç–µ—Å—å –≤—ã–ø—É—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–æ–±—ã—á–Ω–æ 5-10 –º–∏–Ω—É—Ç)

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# === Bot Configuration ===
BOT_TOKEN=7792136369:AAFO5-fcvysbs80eTw4kGToWKlHuYP_ZRt8
ADMIN_IDS=182643037,954230772
ADMIN_GROUP_ID=-1002373429764

# === Webhook Configuration ===
WEBHOOK_HOST=https://bot.indikov.ru
WEBHOOK_SECRET_PATH=hwX9kLmPqR7tUvW2yZ5aBcDeFgHiJkL
WEBHOOK_SECRET_TOKEN=tkn_aK3mN8pQr5sTu9vWx2Yz6AbCdEfGhIj

# === Server Configuration ===
WEB_SERVER_HOST=0.0.0.0
WEB_SERVER_PORT=8080
WEBHOOK_PATH=/webhook
BASE_WEBHOOK_URL=https://bot.indikov.ru

# === N8N Configuration ===
N8N_HOMEWORK_CHECK_URL=https://n8n.indikov.ru/webhook/aa46a723-619e-42e9-8e51-49ba51813718
N8N_ASK_EXPERT_URL=https://n8n.indikov.ru/webhook/83c1f9c5-7833-49c2-9122-22efe590c793
N8N_WEBHOOK_SECRET=n8n_sec_4jK7lM9nP2qR5sT8uV1wX4yZ7aB3cD6e
N8N_DOMAIN=https://n8n.indikov.ru/
N8N_CALLBACK_SECRET=500

# === Monitoring Configuration ===
ALERT_BOT_TOKEN=8058427977:AAHpR5i4uyk_rUQM1ZvAVZxZSwlVPFpEk6c
ALERT_CHAT_ID=-1002373429764

# === Payment Configuration ===
PAYMENT_INSTRUCTIONS=–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –∫—É—Ä—Å–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ –Ω–æ–º–µ—Ä—É +79684494137 –ø–æ –°–ë–ü –Ω–∞ –û–∑–æ–Ω –±–∞–Ω–∫

# === OpenRouter API Key (for AI homework checking) ===
OPENROUTER_API_KEY=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
```

### –°–º–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã (ADMIN_GROUP_ID)

–ü—Ä–∏ —Å–º–µ–Ω–µ –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø—ã –≤–∞–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å ID –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:

**–ì–¥–µ –º–µ–Ω—è—Ç—å ADMIN_GROUP_ID:**

1. **`.env` —Ñ–∞–π–ª** - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
   ```bash
   ADMIN_GROUP_ID=-1002591981307
   ALERT_CHAT_ID=-1002591981307  # –æ–±—ã—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ADMIN_GROUP_ID
   ```

2. **`monitoring/alertmanager.yml`** - –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ (3 –º–µ—Å—Ç–∞):
   ```yaml
   receivers:
     - name: 'telegram'
       telegram_configs:
         - chat_id: -1002591981307  # —Å—Ç—Ä–æ–∫–∞ 24
     
     - name: 'telegram-critical'
       telegram_configs:
         - chat_id: -1002591981307  # —Å—Ç—Ä–æ–∫–∞ 38
     
     - name: 'telegram-warning'
       telegram_configs:
         - chat_id: -1002591981307  # —Å—Ç—Ä–æ–∫–∞ 54
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** Alertmanager –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. ID –≥—Ä—É–ø–ø—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–ø–∏—Å–∞–Ω —è–≤–Ω–æ –≤ `alertmanager.yml`.

---

### –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (docker-compose up -d):

| –°–µ—Ä–≤–∏—Å | URL | –õ–æ–≥–∏–Ω/–ü–∞—Ä–æ–ª—å |
|--------|-----|--------------|
| **–ë–æ—Ç Webhook** | https://bot.indikov.ru | - |
| **n8n** | https://n8n.indikov.ru | admin/admin123 |
| **Grafana** | http://45.147.178.238:3000 | admin/admin123 |
| **Prometheus** | http://45.147.178.238:9090 | - |
| **Alertmanager** | http://45.147.178.238:9093 | - |

---

## üìä –î–∏–∞–≥—Ä–∞–º–º—ã —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

(–î–∏–∞–≥—Ä–∞–º–º—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

---

## üßê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –∏ —Ç–æ—á–∫–∏ —Ä–æ—Å—Ç–∞

(–†–∞–∑–¥–µ–ª –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.