# AntBot - Telegram-–±–æ—Ç –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

AntBot - —ç—Ç–æ –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫—É –î–ó (–≤ —Ç.—á. —á–µ—Ä–µ–∑ AI/n8n) –∏ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É.

---

## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ú–∏–Ω–∏–º—É–º | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
|----------|---------|---------------|
| **CPU** | 1 —è–¥—Ä–æ | 2 —è–¥—Ä–∞ |
| **RAM** | 2 –ì–ë | 4 –ì–ë |
| **–î–∏—Å–∫** | 20 –ì–ë SSD | 40 –ì–ë SSD |
| **–û–°** | Ubuntu 20.04+ | Ubuntu 22.04 |

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**
- Docker –æ–±—Ä–∞–∑—ã –∑–∞–Ω–∏–º–∞—é—Ç ~5-8 –ì–ë
- n8n —Ç—Ä–µ–±—É–µ—Ç RAM –¥–ª—è AI-–æ–±—Ä–∞–±–æ—Ç–∫–∏
- –õ–æ–≥–∏ –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ç—É—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```bash
# –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h

# –ü–∞–º—è—Ç—å
free -h

# –ù–∞–≥—Ä—É–∑–∫–∞
top
```

---

## üöÄ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ (Cloudflare + Docker)

–ü–æ—Å–∫–æ–ª—å–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç **n8n** (–∑–∞–Ω–∏–º–∞—é—â–∏–π –ø–æ—Ä—Ç—ã 80 –∏ 443), –¥–ª—è –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Cloudflare, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

### 1. –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ–ª–µ–≥—Ä–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Webhook —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Ä—Ç—ã 443, 80, 88 –∏–ª–∏ 8443. –ü–æ—Ä—Ç 443 —É–∂–µ –∑–∞–Ω—è—Ç n8n.

### 2. –†–µ—à–µ–Ω–∏–µ: Cloudflare Origin Rules
–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Cloudflare, —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `https://bot.your-domain.com` (–ø–æ—Ä—Ç 443), –Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç **8080**.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Cloudflare Dashboard:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Rules** ‚Üí **Origin Rules**.
2. –ù–∞–∂–º–∏—Ç–µ **Create Rule**.
3. **Field:** Hostname, **Operator:** equals, **Value:** `bot.your-domain.com`.
4. **Destination Port:** Rewrite to `8080`.
5. –ù–∞–∂–º–∏—Ç–µ **Deploy**.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker (`docker-compose.yml`)
–ë–æ—Ç –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç 8080.
```yaml
ports:
  - "8080:8080"
```

### 4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)
–≠—Ç–æ **—Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–æ–∫** (`Empty reply from server` –∏–ª–∏ `Connection refused`).

*   **`WEBAPP_HOST=0.0.0.0`** ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å, aiohttp –º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å —Ç–æ–ª—å–∫–æ IPv6 (`::1`), –∏ Docker –Ω–µ —Å–º–æ–∂–µ—Ç –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å IPv4 —Ç—Ä–∞—Ñ–∏–∫ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
*   **`WEBHOOK_HOST=https://bot.your-domain.com`** ‚Äî –£–∫–∞–∑—ã–≤–∞—Ç—å **–ë–ï–ó –ø–æ—Ä—Ç–∞**, —Ç–∞–∫ –∫–∞–∫ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞ (–¢–µ–ª–µ–≥—Ä–∞–º–∞) —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π HTTPS (443), –∞ –ø–æ–¥–º–µ–Ω—É –ø–æ—Ä—Ç–∞ –¥–µ–ª–∞–µ—Ç Cloudflare —Å–∫—Ä—ã—Ç–æ.

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (SQLite)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

### `users`
–•—Ä–∞–Ω–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö.
- `user_id` (INTEGER, PRIMARY KEY): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram.
- `username` (TEXT): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (@username).
- `first_name` (TEXT): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `last_name` (TEXT): –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `timezone` (TEXT): –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'Europe/Moscow').
- `registered_at` (TIMESTAMP): –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### `courses`
–°–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤.
- `course_id` (TEXT, PRIMARY KEY): –°—Ç—Ä–æ–∫–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, "base").
- `id` (INTEGER): –ß–∏—Å–ª–æ–≤–æ–π –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π ID.
- `group_id` (TEXT): ID Telegram-–∫–∞–Ω–∞–ª–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.
- `title` (TEXT): –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞.
- `course_type` (TEXT): `LESSON_BASED` –∏–ª–∏ `TASK_BASED`.
- `message_interval` (REAL): –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —É—Ä–æ–∫–∞–º–∏ –≤ —á–∞—Å–∞—Ö.
- `description` (TEXT): –û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞.

### `course_versions`
–¢–∞—Ä–∏—Ñ—ã –∏–ª–∏ –≤–µ—Ä—Å–∏–∏ –∫—É—Ä—Å–æ–≤.
- `course_id` (TEXT): –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `courses`.
- `version_id` (TEXT): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "v1", "v2").
- `title` (TEXT): –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞.
- `price` (REAL): –¶–µ–Ω–∞.
- `description` (TEXT): –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞.

### `user_courses`
–°–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `user_id`, `course_id`, `version_id`: –°–æ—Å—Ç–∞–≤–Ω–æ–π –∫–ª—é—á.
- `status` (TEXT): 'active', 'inactive', 'completed'.
- `hw_status` (TEXT): 'none', 'pending', 'approved', 'rejected'.
- `current_lesson` (INTEGER): –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞.
- `level` (INTEGER): –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
- `first_lesson_sent_time`, `last_lesson_sent_time`: –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏.

### `group_messages`
–ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–æ–≤ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.
- `group_id`, `lesson_num`, `course_id`: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
- `content_type` (TEXT): 'text', 'photo', 'video' –∏ —Ç.–¥.
- `is_homework` (BOOLEAN): –§–ª–∞–≥ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.
- `text`, `file_id`: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ.

### `course_activation_codes`
–ö–æ–¥—ã –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤.
- `code_word` (TEXT, PRIMARY KEY): –ö–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
- `course_id`, `version_id`: –ß—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.
- `price_rub` (INTEGER): –¶–µ–Ω–∞.

### `pending_admin_homework`
–û—á–µ—Ä–µ–¥—å –î–ó –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É.
- `admin_message_id` (INTEGER, PRIMARY KEY): ID –≤ –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø–µ.
- `student_user_id`: –ö—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª.
- `course_numeric_id`, `lesson_num`: –ö–æ–Ω—Ç–µ–∫—Å—Ç.

### `user_actions_log`
–ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
- `user_id`, `action_type`, `timestamp`: –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è.
- `course_id`, `lesson_num`, `details`: –ö–æ–Ω—Ç–µ–∫—Å—Ç.

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
    ```bash
    git clone <repo_url>
    cd antbot4
    cp .env.example .env
    nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–í–ê–ñ–ù–û!):**
    
    ‚ö†Ô∏è **–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï:** Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç `settings.json` –∫–∞–∫ **–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é**, –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª:
    
    ```bash
    # –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
    cp settings.json.example settings.json
    
    # –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
    echo '{}' > settings.json
    ```
    
3. **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**
    ```bash
    docker-compose up -d --build
    ```

3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Webhook (–í—Ä—É—á–Ω—É—é):**
    –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä, –ø–æ–¥—Å—Ç–∞–≤–∏–≤ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è:
    ```
    https://api.telegram.org/bot<BOT_TOKEN>/setWebhook?url=https://bot.your-domain.com/<SECRET_PATH>&secret_token=<SECRET_TOKEN>
    ```
    *–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: `"Webhook was set"`.*

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:**
    –ò–∑ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞:
    ```bash
    curl -v http://127.0.0.1:8080/health/live
    ```
    *–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: `HTTP/1.1 200 OK` –∏ `{"status": "alive"}`.*

---

## üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫—É—Ä—Å–æ–≤)

–ï—Å–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞–ª–∏—Å—å —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –≤ `settings.json`, –∏—Ö –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ SQLite:

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```bash
cd ~/antbot4
sqlite3 bot.db
```

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫—É—Ä—Å–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é (–ø—Ä–∏–º–µ—Ä: "–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15")
```sql
DELETE FROM user_courses WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15';
DELETE FROM course_activation_codes WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15';
DELETE FROM course_versions WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15';
DELETE FROM group_messages WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15';
DELETE FROM pending_admin_homework WHERE course_numeric_id IN (SELECT id FROM courses WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15');
DELETE FROM user_actions_log WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15';
DELETE FROM courses WHERE course_id = '–∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å15';
```

### 3. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ (–ø—Ä–∏–º–µ—Ä: "–±–∞–∑–∞" ‚Üí "base")
```sql
UPDATE user_courses SET course_id = 'base' WHERE course_id = '–±–∞–∑–∞';
UPDATE course_activation_codes SET course_id = 'base' WHERE course_id = '–±–∞–∑–∞';
UPDATE course_versions SET course_id = 'base' WHERE course_id = '–±–∞–∑–∞';
UPDATE group_messages SET course_id = 'base' WHERE course_id = '–±–∞–∑–∞';
UPDATE pending_admin_homework SET course_numeric_id = (SELECT id FROM courses WHERE course_id = 'base') WHERE course_numeric_id IN (SELECT id FROM courses WHERE course_id = '–±–∞–∑–∞');
UPDATE user_actions_log SET course_id = 'base' WHERE course_id = '–±–∞–∑–∞';
UPDATE courses SET course_id = 'base', title = 'base' WHERE course_id = '–±–∞–∑–∞';
```

### 4. –í—ã—Ö–æ–¥ –∏–∑ SQLite
```sql
.quit
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ settings.json –≤—Ä—É—á–Ω—É—é
```bash
nano settings.json
```

–û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫—É—Ä—Å—ã –∏ –∫–æ–¥—ã:
```json
{
    "message_interval": 12,
    "tariff_names": {
        "v1": "Solo",
        "v2": "coach",
        "v3": "premium"
    },
    "groups": {
        "-1002549199868": "base"
    },
    "activation_codes": {
        "b1": {"course": "base", "version": "v1", "price": 5000},
        "b22": {"course": "base", "version": "v2", "price": 7000},
        "bvip": {"course": "base", "version": "v3", "price": 18000}
    }
}
```

### 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
docker-compose restart bot
```

---

## üìä –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

| –°–µ—Ä–≤–∏—Å | URL | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç |
|--------|-----|-----------------|
| **–ë–æ—Ç** | `https://bot.your-domain.com` | 8080 |
| **n8n** | `https://n8n.your-domain.com` | 5678 |
| **Grafana** | `http://<IP>:3000` | 3000 |
| **Prometheus** | `http://<IP>:9090` | 9090 |

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ

**–°–∏–º–ø—Ç–æ–º—ã:** –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, n8n –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (–æ—à–∏–±–∫–∞ 521), –ª–æ–≥–∏ –Ω–µ –ø–∏—à—É—Ç—Å—è.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
df -h
# –ï—Å–ª–∏ Use% = 100% –¥–ª—è / ‚Äî –¥–∏—Å–∫ –ø–æ–ª–æ–Ω!
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –û—á–∏—Å—Ç–∏—Ç—å Docker (—Å–∞–º–æ–µ –¥–µ–π—Å—Ç–≤–µ–Ω–Ω–æ–µ)
docker system prune -af
docker volume prune -f

# 2. –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
rm -f logs/*.log
truncate -s 0 logs/bot.log 2>/dev/null

# 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã
rm -f settings_*.json

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker-compose down
docker-compose up -d
```

**–ü—Ä–∏—á–∏–Ω–∞:** Docker –æ–±—Ä–∞–∑—ã –∏ –∫—ç—à –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞. –î–µ–ª–∞–π—Ç–µ –æ—á–∏—Å—Ç–∫—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ.

---

### n8n: –û—à–∏–±–∫–∞ 521 Cloudflare (Web server is down)

**–°–∏–º–ø—Ç–æ–º—ã:** n8n —Ä–∞–±–æ—Ç–∞–µ—Ç (`docker-compose ps n8n` ‚Äî Up), –Ω–æ `https://n8n.indikov.ru` –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É 521.

**–ü—Ä–∏—á–∏–Ω–∞:** Cloudflare —Å—Ç—É—á–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç 443, –∞ n8n —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 5678.

**–†–µ—à–µ–Ω–∏–µ ‚Äî —Å–æ–∑–¥–∞—Ç—å Origin Rule –≤ Cloudflare:**

1. –ó–∞–π–¥–∏—Ç–µ –≤ **Cloudflare Dashboard** ‚Üí **Rules** ‚Üí **Origin Rules**
2. –ù–∞–∂–º–∏—Ç–µ **Create Rule**
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ:
   - **Field:** Hostname
   - **Operator:** equals
   - **Value:** `n8n.indikov.ru`
   - **Destination Port:** Rewrite to `5678`
4. –ù–∞–∂–º–∏—Ç–µ **Deploy**

**–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç –≤ firewall (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ufw):**
```bash
sudo ufw allow 5678/tcp
sudo ufw reload
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ n8n —Å–ª—É—à–∞–µ—Ç
curl http://localhost:5678

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç –≤ firewall
sudo ufw status
```

---

### n8n: –û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (Permission denied)

–ï—Å–ª–∏ n8n –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π `EACCES: permission denied, open '/home/node/.n8n/crash.journal'`:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å n8n
docker-compose stop n8n

# 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É n8n_data
sudo chown -R 1000:1000 ~/antbot4/n8n_data
sudo chmod -R 755 ~/antbot4/n8n_data

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å n8n
docker-compose start n8n

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs n8n --tail=20
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** - –¥–æ–±–∞–≤–∏—Ç—å –≤ `docker-compose.yml`:

```yaml
n8n:
  environment:
    - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false
```

### –ë–æ—Ç: –û—à–∏–±–∫–∞ "no such column"

–ï—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ - –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
docker-compose restart bot

# –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d --build
```

---

## ‚ö†Ô∏è –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ –∏ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. settings.json –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ git pull

**–ü—Ä–æ–±–ª–µ–º–∞:** settings.json —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—É—Ä—Å–æ–≤ –∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ git.

**–†–µ—à–µ–Ω–∏–µ:** –§–∞–π–ª —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore. –ï—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∏:
```bash
git rm --cached settings.json
git commit -m "Remove settings.json from tracking"
```

### 2. Docker —Å–æ–∑–¥–∞—ë—Ç settings.json –∫–∞–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ settings.json –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, Docker —Å–æ–∑–¥–∞—ë—Ç –µ–≥–æ –∫–∞–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, —á—Ç–æ –ª–æ–º–∞–µ—Ç –±–æ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º:
```bash
echo '{}' > settings.json
```

### 3. pending_admin_homework –∏—Å–ø–æ–ª—å–∑—É–µ—Ç created_at, –Ω–µ timestamp

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ç–∞–±–ª–∏—Ü–µ pending_admin_homework –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `created_at` (TIMESTAMP DEFAULT CURRENT_TIMESTAMP), –∞ –Ω–µ `timestamp`.

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–∞–π–º–∞—É—Ç–∞ –î–ó –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç 'YYYY-MM-DD HH:MM:SS', –Ω–µ ISO format:
```python
cutoff_time_str = cutoff_time.strftime('%Y-%m-%d %H:%M:%S')
# –ù–ï: cutoff_time.isoformat()
```

### 4. MarkdownV2 –∑–≤—ë–∑–¥—ã (*) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –±—É–∫–≤–∞–ª—å–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:** –í Telegram –ø—Ä–∏ parse_mode=MarkdownV2 –∑–≤—ë–∑–¥—ã `*—Ç–µ–∫—Å—Ç*` –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –∑–≤—ë–∑–¥—ã, –∞ –Ω–µ –∫–∞–∫ –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `parse_mode=None` –∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `escape_md()`:
```python
await message.answer(text, parse_mode=None)
```

### 5. n8n –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (Permission denied)

**–ü—Ä–æ–±–ª–µ–º–∞:** n8n –ø–∞–¥–∞–µ—Ç —Å `EACCES: permission denied`.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo chown -R 1000:1000 ~/antbot4/n8n_data
```

### 6. –î—É–±–ª–∏–∫–∞—Ç—ã –≤ .env

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –≤ .env –µ—Å—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, BOT_TOKEN –¥–≤–∞–∂–¥—ã), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º.

### 7. WEBAPP_HOST=0.0.0.0 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ–∑ —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π aiohttp –º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å —Ç–æ–ª—å–∫–æ IPv6 (`::1`).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –≤ .env:
```
WEB_SERVER_HOST=0.0.0.0
```

### 8. –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –ë–î –≤ –∫–æ–¥–µ

**–ü—Ä–∞–≤–∏–ª–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ALTER TABLE –≤ –∫–æ–¥–µ –±–æ—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏.

### 9. –ê–¥–º–∏–Ω-—Å–∏—Å—Ç–µ–º–∞: —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω—ã vs –∞–¥–º–∏–Ω—ã –≥—Ä—É–ø–ø—ã

- **–°—É–ø–µ—Ä–∞–¥–º–∏–Ω—ã** ‚Äî –∏–∑ .env ADMIN_IDS (–º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å/–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ë–î)
- **–ê–¥–º–∏–Ω—ã –≥—Ä—É–ø–ø—ã** ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–∏ ADMIN_GROUP_ID (–º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—É—Ä—Å–∞–º–∏)
- **–õ—é–±–æ–π –∞–¥–º–∏–Ω** –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–æ–≥–æ –∞–¥–º–∏–Ω–∞ —á–µ—Ä–µ–∑ `/add_admin`

### 10. 2-–º–∏–Ω—É—Ç–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –î–ó

–ü–æ—Å–ª–µ 2 –º–∏–Ω—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –î–ó –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ n8n webhook. –ê–¥–º–∏–Ω –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- –ï—Å–ª–∏ –∞–¥–º–∏–Ω –æ—Ç–≤–µ—Ç–∏–ª –î–û –æ—Ç–≤–µ—Ç–∞ –æ—Ç n8n ‚Äî —Ä–µ—à–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ
- –ï—Å–ª–∏ n8n –æ—Ç–≤–µ—Ç–∏–ª –ø–µ—Ä–≤—ã–º ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å

---

## üõ† –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫ (Troubleshooting)

### 1. n8n –∏–ª–∏ –ë–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è (–û—à–∏–±–∫–∞ 521 Web server is down)

Cloudflare –≤–∏–¥–∏—Ç —Å–µ—Ä–≤–µ—Ä, –Ω–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:**

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã –≤ Firewall (UFW):
```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 5678/tcp  # –î–ª—è n8n
sudo ufw reload
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Cloudflare (Origin Rules):
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Rules ‚Üí Origin Rules
- –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è `n8n.your-domain.com`
- Destination Port ‚Üí Rewrite to `5678`

### 2. –û—à–∏–±–∫–∞ 525 SSL Handshake Failed

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–Ω—É—Ç—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ HTTP, Cloudflare –Ω–µ –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –í Cloudflare –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SSL/TLS ‚Üí Overview
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–µ–∂–∏–º: **Flexible** (–ì–∏–±–∫–∏–π)

### 3. –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö n8n (SQLITE_ERROR: no such column)

–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ n8n –ø—Ä–µ—Ä–≤–∞–ª–æ—Å—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –º–µ—Å—Ç–∞).

**–†–µ—à–µ–Ω–∏–µ (–ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –±–∞–∑—ã n8n):**

‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≤–æ—Ä–∫—Ñ–ª–æ—É n8n!

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# 2. –£–¥–∞–ª–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –±–∞–∑—ã
sudo rm -rf n8n_data/*

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo chown -R 1000:1000 n8n_data
sudo chmod -R 777 n8n_data

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d
```

---

## üßπ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞

### –û—á–∏—Å—Ç–∫–∞ –º–µ—Å—Ç–∞

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–∏—à–µ—Ç `OSError: [Errno 28] No space left on device`:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
df -h

# 2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã Docker, –∫—ç—à –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker system prune -af

# 3. –û—á–∏—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl --vacuum-time=1d

# 4. –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
rm -f logs/*.log
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–∞–º (Permission Denied)

```bash
# –í—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–ª—è n8n
sudo chown -R 1000:1000 n8n_data
sudo chmod -R 777 n8n_data
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ n8n

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd ~/antbot4

# 2. –°–∫–∞—á–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
docker-compose pull n8n

# 3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d n8n

# 4. –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑ (–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç 1-2 –ì–ë)
docker image prune -f
```

### –ò–º–ø–æ—Ä—Ç workflow –≤ n8n

Workflow –¥–ª—è AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ –î–ó –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `n8n_workflows/AI_Agent.json`.

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n: `https://n8n.indikov.ru`
2. –ú–µ–Ω—é ‚Üí Import from File
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª `n8n_workflows/AI_Agent.json`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ credentials (—Å–º. `n8n_workflows/README.md`)
5. **–í–∫–ª—é—á–∏—Ç–µ workflow** (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–µ–ª—ë–Ω—ã–º)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n credentials

–í n8n –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å 4 credentials:

| Credential | Header/Value |
|------------|---------------|
| **Telegram account** | Bot Token –∏–∑ `.env` |
| **OpenRouter account** | API Key –∏–∑ `.env` |
| **Python to n8n Auth** | Header: `X-N8N-Signature`, Value: –∏–∑ `.env` |
| **n8n to Python Callback Auth** | Header: `X-CALLBACK-SIGNATURE`, Value: –∏–∑ `.env` |

### –ö–æ–º–∞–Ω–¥–∞ /set_hw_timeout

–ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ AI-–ø—Ä–æ–≤–µ—Ä–∫–æ–π:

```
/set_hw_timeout 3    # 3 –º–∏–Ω—É—Ç—ã
/set_hw_timeout 5    # 5 –º–∏–Ω—É—Ç
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2 –º–∏–Ω—É—Ç—ã. –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ `.env`:
```
HW_TIMEOUT_MINUTES=2
```

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
