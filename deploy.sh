#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è AntBot v4

echo "üöÄ –ù–∞—á–∞–ª–æ –¥–µ–ø–ª–æ—è AntBot v4..."

# 1. –î–µ–ª–∞–µ–º –±—ç–∫–∞–ø –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–Ω–∞ —Å–ª—É—á–∞–π –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫)
echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –ë–î –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫..."
cp bot.db bot.db.backup 2>/dev/null
cp settings.json settings.json.backup 2>/dev/null

# 2. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
echo "üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ GitHub..."
git fetch origin
echo "üîÑ –ñ–µ—Å—Ç–∫–∏–π —Å–±—Ä–æ—Å –¥–æ –≤–µ—Ä—Å–∏–∏ –∏–∑ GitHub..."
git reset --hard origin/main

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é
echo "üìã –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞:"
git log -1 --oneline

# 4. –°–æ–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑ (–≤ —ç—Ç–æ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—ã–π –±–æ—Ç –í–°–Å –ï–©–Å –†–ê–ë–û–¢–ê–ï–¢!)
echo "üî® –°–±–æ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ Docker-–æ–±—Ä–∞–∑–∞..."
docker compose build

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–±–æ—Ç –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–≥–æ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥)
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º..."
docker compose up -d

# 6. –û—á–∏—Å—Ç–∫–∞ (–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ "–≤–∏—Å—è—â–∏–µ" –æ–±—Ä–∞–∑—ã, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–±–∏–ª—Å—è –º—É—Å–æ—Ä–æ–º)
echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö Docker-–æ–±—Ä–∞–∑–æ–≤..."
docker image prune -f

# 7. –ü–∞—É–∑–∞, —á—Ç–æ–±—ã –±–æ—Ç —É—Å–ø–µ–ª –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è, –∏ –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤
echo "üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏:"
sleep 3
docker compose logs bot --tail=30

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω!"